---
import ApiDemo from "~/layouts/ApiDemo.astro";
---

<ApiDemo 
	title="æ•°å­—è½¬å¤§å†™ - WASM Toolkit"
	apiName="æ•°å­—è½¬å¤§å†™"
	description="å°†é˜¿æ‹‰ä¼¯æ•°å­—è½¬æ¢ä¸ºä¸­æ–‡å¤§å†™æ ¼å¼"
	color="green"
	icon="ğŸ”¤"
>
	<div class="p-4 sm:p-6">
		<!-- API Description -->
		<div class="mb-6 text-center">
			<p class="text-gray-600">å°†é˜¿æ‹‰ä¼¯æ•°å­—è½¬æ¢ä¸ºä¸­æ–‡å¤§å†™æ ¼å¼</p>
		</div>
		
		<div class="grid lg:grid-cols-2 gap-6">
			<!-- è¾“å…¥åŒºåŸŸ -->
			<div>
				<h3 class="text-lg font-medium text-gray-900 mb-3">æ•°å­—è¾“å…¥</h3>
				<div class="space-y-3">
					<input 
						type="number" 
						id="digit-input" 
						class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
						placeholder="ä¾‹å¦‚: 123.45"
						value="123.45"
						step="any"
					>
					
					<button 
						id="convert-btn"
						class="w-full bg-green-600 text-white py-2.5 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200 font-medium"
					>
						ğŸ”¤ è½¬æ¢ä¸ºå¤§å†™
					</button>
				</div>

				<!-- é¢„è®¾ç¤ºä¾‹ -->
				<div class="mt-4">
					<h4 class="text-sm font-medium text-gray-700 mb-2">å¸¸ç”¨ç¤ºä¾‹</h4>
					<div class="grid grid-cols-3 gap-1.5">
						<button class="example-digit px-2 py-2 bg-green-50 hover:bg-green-100 rounded text-xs transition-colors border border-green-200" data-value="0">
							<div class="font-medium text-green-800">0</div>
						</button>
						<button class="example-digit px-2 py-2 bg-green-50 hover:bg-green-100 rounded text-xs transition-colors border border-green-200" data-value="100">
							<div class="font-medium text-green-800">100</div>
						</button>
						<button class="example-digit px-2 py-2 bg-green-50 hover:bg-green-100 rounded text-xs transition-colors border border-green-200" data-value="1000">
							<div class="font-medium text-green-800">1,000</div>
						</button>
						<button class="example-digit px-2 py-2 bg-green-50 hover:bg-green-100 rounded text-xs transition-colors border border-green-200" data-value="10000">
							<div class="font-medium text-green-800">10,000</div>
						</button>
						<button class="example-digit px-2 py-2 bg-green-50 hover:bg-green-100 rounded text-xs transition-colors border border-green-200" data-value="123.45">
							<div class="font-medium text-green-800">123.45</div>
						</button>
						<button class="example-digit px-2 py-2 bg-green-50 hover:bg-green-100 rounded text-xs transition-colors border border-green-200" data-value="999999">
							<div class="font-medium text-green-800">999,999</div>
						</button>
					</div>
				</div>

				<!-- éšæœºæ•°ç”Ÿæˆ -->
				<div class="mt-4">
					<h4 class="text-sm font-medium text-gray-700 mb-2">éšæœºæµ‹è¯•</h4>
					<div class="grid grid-cols-3 gap-1.5">
						<button id="random-int" class="px-2 py-2 bg-gray-100 hover:bg-gray-200 rounded text-xs transition-colors">
							éšæœºæ•´æ•°
						</button>
						<button id="random-decimal" class="px-2 py-2 bg-gray-100 hover:bg-gray-200 rounded text-xs transition-colors">
							éšæœºå°æ•°
						</button>
						<button id="random-large" class="px-2 py-2 bg-gray-100 hover:bg-gray-200 rounded text-xs transition-colors">
							éšæœºå¤§æ•°
						</button>
					</div>
				</div>
			</div>

			<!-- è¾“å‡ºåŒºåŸŸ -->
			<div>
				<h3 class="text-lg font-medium text-gray-900 mb-3">è½¬æ¢ç»“æœ</h3>
				<div class="bg-gray-50 border border-gray-200 rounded-lg p-4 min-h-[150px] flex items-center justify-center">
					<div id="digit-output" class="text-center">
						<div class="text-2xl font-bold text-green-800 mb-2" id="result-text">
							å£¹ä½°è´°æ‹¾åç‚¹è‚†ä¼
						</div>
						<div class="text-gray-500 text-sm">ä¸­æ–‡å¤§å†™æ•°å­—</div>
					</div>
				</div>

				<!-- æ€§èƒ½å’Œç»Ÿè®¡ -->
				<div class="mt-3 grid grid-cols-2 gap-3">
					<div class="p-2.5 bg-green-50 rounded-lg">
						<div class="flex items-center justify-between text-sm">
							<span class="text-green-800">å¤„ç†æ—¶é—´</span>
							<span id="convert-time" class="text-green-600 font-mono">0.23 ms</span>
						</div>
					</div>
					<div class="p-2.5 bg-blue-50 rounded-lg">
						<div class="flex items-center justify-between text-sm">
							<span class="text-blue-800">å­—ç¬¦é•¿åº¦</span>
							<span id="char-count" class="text-blue-600 font-mono">9</span>
						</div>
					</div>
				</div>

				<!-- å†å²è®°å½• -->
				<div class="mt-4">
					<h4 class="text-sm font-medium text-gray-700 mb-2">è½¬æ¢å†å²</h4>
					<div id="history" class="space-y-1.5 max-h-32 overflow-y-auto">
						<!-- å†å²è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
					</div>
				</div>
			</div>
		</div>

		<!-- ç®€åŒ–è¯´æ˜ -->
		<div class="mt-8 pt-6 border-t border-gray-200">
			<div class="grid sm:grid-cols-2 gap-6 text-sm">
				<div>
					<h4 class="font-medium text-gray-900 mb-2">âœ¨ è½¬æ¢è§„åˆ™</h4>
					<ul class="space-y-1 text-gray-600">
						<li>â€¢ é›¶ã€å£¹ã€è´°ã€åã€è‚†ã€ä¼ã€é™†ã€æŸ’ã€æŒã€ç–</li>
						<li>â€¢ æ‹¾ã€ä½°ã€ä»Ÿã€ä¸‡ã€äº¿ç­‰å•ä½å¤„ç†</li>
						<li>â€¢ å°æ•°ç‚¹åé€ä½è½¬æ¢</li>
					</ul>
				</div>
				
				<div>
					<h4 class="font-medium text-gray-900 mb-2">ğŸ¯ åº”ç”¨åœºæ™¯</h4>
					<ul class="space-y-1 text-gray-600">
						<li>â€¢ è´¢åŠ¡æŠ¥è¡¨é‡‘é¢æ˜¾ç¤º</li>
						<li>â€¢ æ”¯ç¥¨æ±‡ç¥¨é‡‘é¢ä¹¦å†™</li>
						<li>â€¢ åˆåŒæ³•å¾‹æ–‡ä»¶è¡¨è¿°</li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<script>
		async function initDigitUppercase() {
			try {
				const wasm = await import("#/wlin_toolkit");
				const { digitUppercase } = wasm;

				const input = document.getElementById("digit-input") as HTMLInputElement;
				const output = document.getElementById("result-text") as HTMLElement;
				const convertTime = document.getElementById("convert-time") as HTMLElement;
				const charCount = document.getElementById("char-count") as HTMLElement;
				const convertBtn = document.getElementById("convert-btn") as HTMLButtonElement;
				const history = document.getElementById("history") as HTMLDivElement;
				
				const exampleBtns = document.querySelectorAll(".example-digit") as NodeListOf<HTMLButtonElement>;
				const randomBtns = {
					int: document.getElementById("random-int"),
					decimal: document.getElementById("random-decimal"),
					large: document.getElementById("random-large")
				};

				let historyList: {
					number: number;
					result: string;
					time: string;
					timestamp: Date;
				}[] = [];

				function addToHistory(number: number, result: string, time: string) {
					historyList.unshift({ number, result, time, timestamp: new Date() });
					if (historyList.length > 5) historyList.pop();
					
					history.innerHTML = historyList.map(item => 
						`<div class="flex justify-between items-center p-2 bg-white rounded border text-xs">
							<span class="font-mono">${item.number}</span>
							<span class="text-gray-500 truncate ml-2">${item.result.length > 15 ? item.result.substring(0, 15) + '...' : item.result}</span>
						</div>`
					).join('');
				}

				function convertNumber() {
					const startTime = performance.now();
					
					try {
						const number = parseFloat(input.value);
						if (isNaN(number)) {
							output.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—';
							output.className = 'text-2xl font-bold text-red-600 mb-2';
							return;
						}

						const result = digitUppercase(number);
						const endTime = performance.now();
						const processingTime = (endTime - startTime).toFixed(2);
						
						output.textContent = result;
						output.className = 'text-2xl font-bold text-green-800 mb-2';
						convertTime.textContent = `${processingTime} ms`;
						charCount.textContent = result.length.toString();

						addToHistory(number, result, processingTime);
						
					} catch (error) {
						output.textContent = `é”™è¯¯: ${(error as Error).message}`;
						output.className = 'text-lg font-bold text-red-600 mb-2';
						convertTime.textContent = 'Error';
						charCount.textContent = '0';
					}
				}

				// åˆå§‹è½¬æ¢
				convertNumber();

				convertBtn.addEventListener('click', convertNumber);

				// é¢„è®¾ç¤ºä¾‹
				exampleBtns.forEach(btn => {
					btn.addEventListener('click', () => {
						input.value = btn.dataset.value as string;
						convertNumber();
					});
				});

				// éšæœºæ•°ç”Ÿæˆ
				randomBtns.int?.addEventListener('click', () => {
					input.value = Math.floor(Math.random() * 100000).toString();
					convertNumber();
				});

				randomBtns.decimal?.addEventListener('click', () => {
					input.value = (Math.random() * 1000).toFixed(2);
					convertNumber();
				});

				randomBtns.large?.addEventListener('click', () => {
					input.value = Math.floor(Math.random() * 999999999).toString();
					convertNumber();
				});

				// å®æ—¶è½¬æ¢
				input.addEventListener('input', convertNumber);

				// å›è½¦é”®æ”¯æŒ
				input.addEventListener('keypress', (e) => {
					if (e.key === 'Enter') {
						convertNumber();
					}
				});

			} catch (error) {
				document.getElementById("result-text")!.textContent = 
					`WASM æ¨¡å—åŠ è½½å¤±è´¥: ${(error as Error).message}`;
				document.getElementById("result-text")!.className = 
					'text-lg font-bold text-red-600 mb-2';
			}
		}

		initDigitUppercase();
	</script>
</ApiDemo>