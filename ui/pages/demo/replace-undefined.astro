---
import ApiDemo from "~/layouts/ApiDemo.astro";
---

<ApiDemo 
	title="Replace Undefined - WASM Toolkit"
	apiName="Replace Undefined"
	description="å°† JavaScript å¯¹è±¡ä¸­çš„ undefined å€¼æ›¿æ¢ä¸º null"
	color="blue"
	icon="ğŸ”„"
>
	<div class="p-4 sm:p-6">
		<!-- API Description -->
		<div class="mb-6 text-center">
			<p class="text-gray-600">å°† JavaScript å¯¹è±¡ä¸­çš„ undefined å€¼æ›¿æ¢ä¸º null</p>
		</div>
		
		<div class="grid lg:grid-cols-2 gap-6">
			<!-- è¾“å…¥åŒºåŸŸ -->
			<div>
				<h3 class="text-lg font-medium text-gray-900 mb-3">æµ‹è¯•è¾“å…¥</h3>
				<div class="space-y-3">
					<textarea
						id="replace-input"
						class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-mono"
						rows="6"
						placeholder="è¾“å…¥åŒ…å« undefined çš„ JavaScript å¯¹è±¡..."
					>{`{
  "name": "John",
  "age": undefined,
  "hobbies": ["reading", undefined],
  "email": undefined
}`}</textarea>
					
					<button
						id="replace-btn"
						class="w-full bg-blue-600 text-white py-2.5 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium"
					>
						ğŸ”„ è½¬æ¢æ•°æ®
					</button>
				</div>

				<!-- é¢„è®¾ç¤ºä¾‹ -->
				<div class="mt-4">
					<h4 class="text-sm font-medium text-gray-700 mb-2">å¿«é€Ÿç¤ºä¾‹</h4>
					<div class="grid grid-cols-1 gap-1.5">
						<button
							class="example-btn text-left px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs transition-colors"
							data-example="simple"
						>
							<span class="font-medium text-gray-900">ç®€å•å¯¹è±¡</span>
						</button>
						<button
							class="example-btn text-left px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs transition-colors"
							data-example="array"
						>
							<span class="font-medium text-gray-900">æ•°ç»„å¤„ç†</span>
						</button>
						<button
							class="example-btn text-left px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded text-xs transition-colors"
							data-example="nested"
						>
							<span class="font-medium text-gray-900">åµŒå¥—ç»“æ„</span>
						</button>
					</div>
				</div>
			</div>

			<!-- è¾“å‡ºåŒºåŸŸ -->
			<div>
				<h3 class="text-lg font-medium text-gray-900 mb-3">è½¬æ¢ç»“æœ</h3>
				<div class="bg-gray-50 border border-gray-200 rounded-lg p-3 min-h-[200px]">
					<div
						id="replace-output"
						class="text-sm font-mono whitespace-pre-wrap"
					>
						<span class="text-gray-500">ç‚¹å‡»"è½¬æ¢æ•°æ®"æŸ¥çœ‹ç»“æœ...</span>
					</div>
				</div>

				<!-- æ€§èƒ½æŒ‡æ ‡ -->
				<div class="mt-3 p-2.5 bg-blue-50 rounded-lg">
					<div class="flex items-center justify-between text-sm">
						<span class="text-blue-800">å¤„ç†æ—¶é—´</span>
						<span id="process-time" class="text-blue-600 font-mono">-</span>
					</div>
				</div>
			</div>
		</div>

		<!-- ç®€åŒ–è¯´æ˜ -->
		<div class="mt-8 pt-6 border-t border-gray-200">
			<div class="grid sm:grid-cols-2 gap-6 text-sm">
				<div>
					<h4 class="font-medium text-gray-900 mb-2">âœ¨ åŠŸèƒ½</h4>
					<ul class="space-y-1 text-gray-600">
						<li>â€¢ æ·±åº¦éå†å¯¹è±¡å’Œæ•°ç»„</li>
						<li>â€¢ ä¿æŒåŸå§‹æ•°æ®ç»“æ„</li>
						<li>â€¢ JSON åºåˆ—åŒ–å…¼å®¹</li>
					</ul>
				</div>
				
				<div>
					<h4 class="font-medium text-gray-900 mb-2">ğŸ¯ åœºæ™¯</h4>
					<ul class="space-y-1 text-gray-600">
						<li>â€¢ API æ•°æ®æ¸…ç†</li>
						<li>â€¢ æ•°æ®åº“å­˜å‚¨é¢„å¤„ç†</li>
						<li>â€¢ JSON åºåˆ—åŒ–å¤„ç†</li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<script>
		async function initReplaceUndefined() {
			try {
				const wasm = await import("#/wlin_toolkit");
				const { replaceUndefinedWithNull } = wasm;

				const input = document.getElementById(
					"replace-input"
				) as HTMLInputElement;
				const output = document.getElementById("replace-output") as HTMLElement;
				const processTime = document.getElementById(
					"process-time"
				) as HTMLElement;
				const replaceBtn = document.getElementById(
					"replace-btn"
				) as HTMLButtonElement;
				const exampleBtns = document.querySelectorAll(
					".example-btn"
				) as NodeListOf<HTMLButtonElement>;

				const examples = {
					simple: `{
  "name": "John",
  "age": undefined,
  "active": true,
  "score": null
}`,
					array: `[
  1,
  undefined,
  "hello",
  null,
  undefined
]`,
					nested: `{
  "user": {
    "name": "Alice",
    "bio": undefined,
    "settings": {
      "theme": "dark",
      "notifications": undefined
    }
  },
  "posts": [
    {
      "title": "Hello World",
      "content": undefined
    }
  ]
}`,
				};

				function processData() {
					const startTime = performance.now();

					try {
						const inputText = input.value.trim();
						if (!inputText) {
							output.innerHTML =
								'<span class="text-red-600">è¯·è¾“å…¥è¦å¤„ç†çš„æ•°æ®</span>';
							return;
						}

						// ä½¿ç”¨ eval è§£æåŒ…å« undefined çš„ JavaScript å¯¹è±¡
						const testData = eval(`(${inputText})`);
						const result = replaceUndefinedWithNull(testData);

						const endTime = performance.now();
						const processingTime = (endTime - startTime).toFixed(2);

						output.innerHTML = `<span class="text-green-800">${JSON.stringify(result, null, 2)}</span>`;
						processTime.textContent = `${processingTime} ms`;
					} catch (error) {
						output.innerHTML = `<span class="text-red-600">é”™è¯¯: ${(error as Error).message}</span>`;
						processTime.textContent = "Error";
					}
				}

				replaceBtn.addEventListener("click", processData);

				// é¢„è®¾ç¤ºä¾‹
				exampleBtns.forEach((btn) => {
					btn.addEventListener("click", () => {
						const example = btn.dataset.example;
						input.value = examples[example as keyof typeof examples];
						processData();
					});
				});

				// å›è½¦é”®æ”¯æŒ (Ctrl/Cmd + Enter)
				input.addEventListener("keydown", (e) => {
					if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
						processData();
					}
				});
			} catch (error) {
				document.getElementById("replace-output")!.innerHTML =
					`<span class="text-red-600">WASM æ¨¡å—åŠ è½½å¤±è´¥: ${(error as Error).message}</span>`;
			}
		}

		initReplaceUndefined();
	</script>
</ApiDemo>